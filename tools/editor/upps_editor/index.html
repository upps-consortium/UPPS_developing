<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPPS Persona Editor v2025.3</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- External Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- External JavaScript Libraries -->
    <!-- Alpine.js (Êñ∞„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„ÅßÂøÖÈ†à) -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- D3.js for Visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- YAML Parser -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    
    <!-- üÜï Êñ∞„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£ Core System -->
    <script type="module" src="js/core/StateManager.js"></script>
    <script type="module" src="js/core/EventBus.js"></script>
    <script type="module" src="js/core/ModuleRegistry.js"></script>
    <script type="module" src="js/core/AppController.js"></script>
    
    <!-- üÜï Domain Modules -->
    <script type="module" src="js/modules/EmotionModule.js"></script>
    <script type="module" src="js/modules/MemoryModule.js"></script>
    <script type="module" src="js/modules/AssociationModule.js"></script>
    <script type="module" src="js/modules/CognitiveModule.js"></script>
    
    <!-- üÜï UI Controllers -->
    <script type="module" src="js/ui/TabController.js"></script>
    <script type="module" src="js/ui/ModalController.js"></script>
    <script type="module" src="js/ui/NotificationController.js"></script>
    
    <!-- üîÑ Existing Visualizer Files (snake_caseÂêçÁ∂≠ÊåÅ) -->
    <script src="js/visualizer/network_visualizer.js"></script>
    <script src="js/visualizer/radar_chart.js"></script>
    <script src="js/visualizer/node_editor.js"></script>
    
    <!-- üÜï Integration Layer (ÊúÄÂæå„Å´Ë™≠„ÅøËæº„Åø) -->
    <script type="module" src="js/integration/AlpineIntegration.js"></script>
    <script type="module" src="js/integration/AppBootstrap.js"></script>
    
    <!-- Custom Styles -->
    <style>
        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* „Çø„Éñ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã */
        .tab-active {
            @apply bg-blue-500 text-white;
        }
        
        /* „Éì„Ç∏„É•„Ç¢„É©„Ç§„Ç∂„ÉºÁî® */
        #network-visualizer {
            width: 100%;
            height: 400px;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        /* ÈÄöÁü•„Ç≥„É≥„ÉÜ„Éä */
        #notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ -->
    <div x-data="{ loading: true }" 
         x-show="loading" 
         x-init="setTimeout(() => loading = false, 2000)"
         class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">UPPS Persona Editor „ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
        </div>
    </div>

    <!-- „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ -->
    <div x-data="uppsApp()" 
         x-show="!loading" 
         x-init="init()"
         class="min-h-screen">
        
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-900">
                            UPPS Persona Editor
                        </h1>
                        <span class="ml-2 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded">
                            v2025.3
                        </span>
                    </div>
                    
                    <!-- „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„Éú„Çø„É≥ -->
                    <div class="flex items-center space-x-2">
                        <button @click="showModal('importModal')" 
                                class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                            „Ç§„É≥„Éù„Éº„Éà
                        </button>
                        <button @click="exportData()" 
                                class="px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                            „Ç®„ÇØ„Çπ„Éù„Éº„Éà
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
        <nav class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button @click="switchTab('basic')" 
                            :class="isActiveTab('basic') ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm">
                        <i data-lucide="user" class="w-4 h-4 inline-block mr-2"></i>
                        Âü∫Êú¨ÊÉÖÂ†±
                    </button>
                    <button @click="switchTab('emotion')" 
                            :class="isActiveTab('emotion') ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm">
                        <i data-lucide="heart" class="w-4 h-4 inline-block mr-2"></i>
                        ÊÑüÊÉÖ
                    </button>
                    <button @click="switchTab('personality')" 
                            :class="isActiveTab('personality') ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm">
                        <i data-lucide="brain" class="w-4 h-4 inline-block mr-2"></i>
                        ÊÄßÊ†º
                    </button>
                    <button @click="switchTab('memory')" 
                            :class="isActiveTab('memory') ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm">
                        <i data-lucide="book-open" class="w-4 h-4 inline-block mr-2"></i>
                        Ë®òÊÜ∂
                    </button>
                    <button @click="switchTab('association')" 
                            :class="isActiveTab('association') ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm">
                        <i data-lucide="share-2" class="w-4 h-4 inline-block mr-2"></i>
                        Èñ¢ÈÄ£ÊÄß
                    </button>
                    <button @click="switchTab('cognitive')" 
                            :class="isActiveTab('cognitive') ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm">
                        <i data-lucide="zap" class="w-4 h-4 inline-block mr-2"></i>
                        Ë™çÁü•ËÉΩÂäõ
                    </button>
                </div>
            </div>
        </nav>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ -->
        <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            
            <!-- Âü∫Êú¨ÊÉÖÂ†±„Çø„Éñ -->
            <div x-show="isActiveTab('basic')" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 id="basic-tab">
                <div x-data="{ src: 'tabs/basic.html', loaded: false }"
                     x-init="fetch(src).then(response => response.text()).then(html => { $el.innerHTML = html; loaded = true; })">
                    <div x-show="!loaded" class="flex justify-center py-8">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- ÊÑüÊÉÖ„Çø„Éñ -->
            <div x-show="isActiveTab('emotion')" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 id="emotion-tab">
                <div x-data="{ src: 'tabs/emotion.html', loaded: false }"
                     x-init="fetch(src).then(response => response.text()).then(html => { $el.innerHTML = html; loaded = true; })">
                    <div x-show="!loaded" class="flex justify-center py-8">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- ÊÄßÊ†º„Çø„Éñ -->
            <div x-show="isActiveTab('personality')" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 id="personality-tab">
                <div x-data="{ src: 'tabs/personality.html', loaded: false }"
                     x-init="fetch(src).then(response => response.text()).then(html => { $el.innerHTML = html; loaded = true; })">
                    <div x-show="!loaded" class="flex justify-center py-8">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Ë®òÊÜ∂„Çø„Éñ -->
            <div x-show="isActiveTab('memory')" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 id="memory-tab">
                <div x-data="{ src: 'tabs/memory.html', loaded: false }"
                     x-init="fetch(src).then(response => response.text()).then(html => { $el.innerHTML = html; loaded = true; })">
                    <div x-show="!loaded" class="flex justify-center py-8">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Èñ¢ÈÄ£ÊÄß„Çø„Éñ -->
            <div x-show="isActiveTab('association')" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 id="association-tab">
                <div x-data="{ src: 'tabs/association.html', loaded: false }"
                     x-init="fetch(src).then(response => response.text()).then(html => { $el.innerHTML = html; loaded = true; })">
                    <div x-show="!loaded" class="flex justify-center py-8">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <!-- Ë™çÁü•ËÉΩÂäõ„Çø„Éñ -->
            <div x-show="isActiveTab('cognitive')" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-4"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 id="cognitive-tab">
                <div x-data="{ src: 'tabs/cognitive.html', loaded: false }"
                     x-init="fetch(src).then(response => response.text()).then(html => { $el.innerHTML = html; loaded = true; })">
                    <div x-show="!loaded" class="flex justify-center py-8">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- ÈÄöÁü•„Ç≥„É≥„ÉÜ„Éä -->
    <div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2 max-w-sm">
        <!-- ÈÄöÁü•„ÅØNotificationController„Å´„Çà„Å£„Å¶ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
    </div>

    <!-- „É¢„Éº„ÉÄ„É´„Ç≥„É≥„ÉÜ„Éä -->
    <div id="modal-container">
        <!-- „É¢„Éº„ÉÄ„É´„ÅØModalController„Å´„Çà„Å£„Å¶ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
    </div>

    <!-- „Éì„Ç∏„É•„Ç¢„É©„Ç§„Ç∂„Éº„É¢„Éº„ÉÄ„É´ -->
    <div x-data="{ open: false }" 
         x-show="open" 
         @keydown.escape.window="open = false"
         @open-visualizer.window="open = true"
         @close-visualizer.window="open = false"
         class="fixed inset-0 z-50 overflow-y-auto"
         style="display: none;">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="open = false"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
                <!-- „Éò„ÉÉ„ÉÄ„Éº -->
                <div class="flex items-center justify-between p-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Èñ¢ÈÄ£ÊÄß„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂèØË¶ñÂåñ</h3>
                    <button @click="open = false" class="text-gray-400 hover:text-gray-500">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                <div class="p-4">
                    <div id="network-visualizer"></div>
                </div>
                
                <!-- „Éï„ÉÉ„Çø„Éº -->
                <div class="flex justify-end space-x-2 p-4 border-t border-gray-200">
                    <button @click="refreshVisualizer()" 
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                        Êõ¥Êñ∞
                    </button>
                    <button @click="open = false" 
                            class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                        Èñâ„Åò„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±ÔºàÈñãÁô∫ÊôÇ„ÅÆ„ÅøË°®Á§∫Ôºâ -->
    <div x-data="{ showDebug: false }" 
         @keydown.ctrl.shift.d.window="showDebug = !showDebug"
         x-show="showDebug"
         class="fixed bottom-4 left-4 bg-black bg-opacity-80 text-white p-4 rounded-lg text-sm max-w-md">
        <h4 class="font-bold mb-2">üîß „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± (Ctrl+Shift+D)</h4>
        <div x-text="`„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„Éñ: ${$store.app.activeTab}`"></div>
        <div x-text="`„É¢„Ç∏„É•„Éº„É´: ${Object.keys(window.moduleRegistry?.modules || {}).length}ÂÄã`"></div>
        <div x-text="`„Ç§„Éô„É≥„Éà: ${window.eventBus?.stats?.emitted || 0}ÂÄãÁô∫ÁÅ´`"></div>
        <button @click="showDebug = false" class="mt-2 text-xs underline">Èñâ„Åò„Çã</button>
    </div>

    <!-- ÂàùÊúüÂåñÂæå„ÅÆÂá¶ÁêÜ -->
    <script>
        // DOMË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„ÅÆÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', function() {
            // Lucide icons „ÅÆÂàùÊúüÂåñ
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±
            console.log('üöÄ UPPS Persona Editor v2025.3 initialized');
            console.log('üì¶ Architecture: Event-driven Modular');
            console.log('‚ö° Framework: Alpine.js + TailwindCSS');
        });

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞ÔºàÊó¢Â≠ò„Ç≥„Éº„Éâ„Å®„ÅÆ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÔºâ
        window.showVisualizer = function() {
            window.dispatchEvent(new CustomEvent('open-visualizer'));
        };

        window.refreshVisualizer = function() {
            if (window.networkVisualization && typeof window.networkVisualization.refresh === 'function') {
                window.networkVisualization.refresh();
            }
        };

        window.exportData = function() {
            if (window.stateManager) {
                const personaData = window.stateManager.getState('persona');
                const dataStr = JSON.stringify(personaData, null, 2);
                const blob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `upps_persona_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                // ÊàêÂäüÈÄöÁü•
                if (window.notificationController) {
                    window.notificationController.success('„Éö„É´„ÇΩ„Éä„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü');
                }
            }
        };
    </script>
</body>
</html>