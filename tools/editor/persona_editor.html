<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPPSãƒšãƒ«ã‚½ãƒŠã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼</title>
    <style>
        /* CSS Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3b82f6;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            
            --border-radius: 8px;
            --box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-areas: 
                "header header"
                "nav content";
            grid-template-columns: 250px 1fr;
            grid-template-rows: auto 1fr;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: var(--bg-primary);
            box-shadow: var(--box-shadow);
        }

        /* Header */
        .header {
            grid-area: header;
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn--primary {
            background: white;
            color: var(--primary-color);
        }

        .btn--primary:hover {
            background: var(--bg-tertiary);
        }

        .btn--secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn--secondary:hover {
            background: var(--bg-tertiary);
        }

        /* Navigation */
        .tab-nav {
            grid-area: nav;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 1rem 0;
        }

        .tab-btn {
            display: block;
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            text-align: left;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .tab-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--bg-primary);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 500;
        }

        /* Content Area */
        .content {
            grid-area: content;
            padding: 2rem;
            overflow-y: auto;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Form Components */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-help {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Slider Components */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .slider-input {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        .slider-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        .slider-value {
            min-width: 50px;
            text-align: right;
            font-weight: 500;
            color: var(--primary-color);
        }

        /* Cards */
        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--box-shadow);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        /* Preview */
        .preview-container {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 500px;
        }

        /* Notifications */
        .notification {
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .notification--success {
            background: rgba(16, 185, 129, 0.1);
            color: #065f46;
            border-left: 4px solid var(--success-color);
        }

        .notification--error {
            background: rgba(239, 68, 68, 0.1);
            color: #991b1b;
            border-left: 4px solid var(--error-color);
        }

        .notification--warning {
            background: rgba(245, 158, 11, 0.1);
            color: #92400e;
            border-left: 4px solid var(--warning-color);
        }

        /* Hidden File Input */
        .file-input {
            display: none;
        }

        /* Association Network Styles */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .associations-table-container {
            overflow-x: auto;
        }

        .associations-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .associations-table th,
        .associations-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .associations-table th {
            background: var(--bg-secondary);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .associations-table td {
            font-size: 0.875rem;
            vertical-align: middle;
        }

        .trigger-display,
        .response-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .trigger-type-icon,
        .response-type-icon {
            font-size: 1.1rem;
        }

        .trigger-details,
        .response-details {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .strength-bar {
            font-family: monospace;
            font-size: 0.875rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            transition: var(--transition);
        }

        .btn-icon:hover {
            background: var(--bg-tertiary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        /* Form Steps */
        .form-steps .step {
            display: none;
        }

        .form-steps .step.active {
            display: block;
        }

        /* Radio Cards */
        .trigger-type-selection {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .radio-card {
            display: block;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .radio-card input[type="radio"] {
            display: none;
        }

        .radio-card:hover {
            border-color: var(--primary-color);
        }

        .radio-card input[type="radio"]:checked + .radio-card-content {
            color: var(--primary-color);
        }

        .radio-card input[type="radio"]:checked {
            border-color: var(--primary-color);
        }

        .radio-card-content strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .radio-card-content small {
            color: var(--text-secondary);
        }

        /* Strength Guide */
        .strength-guide {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
            text-align: center;
        }

        /* Trigger Details Forms */
        .external-trigger-form,
        .emotion-trigger-form,
        .memory-trigger-form {
            margin-top: 1rem;
        }

        .trigger-items-input {
            min-height: 80px;
            resize: vertical;
        }

        /* Template Styles */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .template-card {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-primary);
        }

        .template-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
        }

        .template-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .template-icon {
            font-size: 1.5rem;
        }

        .template-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .template-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }

        .template-preview {
            background: var(--bg-tertiary);
            border-radius: 4px;
            padding: 0.5rem;
            font-size: 0.75rem;
            font-family: monospace;
            color: var(--text-secondary);
        }

        .template-tag {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                grid-template-areas: 
                    "header"
                    "nav"
                    "content";
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
            }

            .tab-nav {
                display: flex;
                overflow-x: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 0;
            }

            .tab-btn {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .tab-btn.active {
                border-left: none;
                border-bottom-color: var(--primary-color);
            }

            .content {
                padding: 1rem;
            }

            .header-buttons {
                flex-direction: column;
                gap: 0.25rem;
            }

            .header-buttons .btn {
                font-size: 0.75rem;
                padding: 0.375rem 0.75rem;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }

            .associations-table-container {
                font-size: 0.75rem;
            }

            .associations-table th,
            .associations-table td {
                padding: 0.5rem 0.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>UPPSãƒšãƒ«ã‚½ãƒŠã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼</h1>
            <div class="header-actions">
                <button class="btn btn--primary" onclick="app.handleNewPersona()">
                    âœ¨ æ–°è¦ä½œæˆ
                </button>
                <button class="btn btn--primary" onclick="app.handleLoadFile()">
                    ğŸ“ é–‹ã
                </button>
                <button class="btn btn--primary" onclick="app.handleSaveFile()">
                    ğŸ’¾ ä¿å­˜
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="personal">
                ğŸ‘¤ åŸºæœ¬æƒ…å ±
            </button>
            <button class="tab-btn" data-tab="personality">
                ğŸ§  æ€§æ ¼ç‰¹æ€§
            </button>
            <button class="tab-btn" data-tab="emotions">
                ğŸ˜Š æ„Ÿæƒ…ã‚·ã‚¹ãƒ†ãƒ 
            </button>
            <button class="tab-btn" data-tab="associations">
                ğŸ”— é–¢é€£æ€§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
            </button>
            <button class="tab-btn" data-tab="preview">
                ğŸ“„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
            </button>
        </nav>

        <!-- Content -->
        <main class="content">
            <!-- Notifications -->
            <div id="notifications"></div>

            <!-- Personal Info Tab -->
            <div id="personal-tab" class="tab-panel active">
                <div class="card">
                    <h2 class="card-title">åŸºæœ¬æƒ…å ±</h2>
                    
                    <div class="form-group">
                        <label for="persona-name">æ°å</label>
                        <input type="text" id="persona-name" placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ" class="persona-input">
                    </div>

                    <div class="form-group">
                        <label for="persona-age">å¹´é½¢</label>
                        <input type="number" id="persona-age" placeholder="ä¾‹: 25" min="0" max="150" class="persona-input">
                    </div>

                    <div class="form-group">
                        <label for="persona-gender">æ€§åˆ¥</label>
                        <select id="persona-gender" class="persona-input">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="Male">ç”·æ€§</option>
                            <option value="Female">å¥³æ€§</option>
                            <option value="Other">ãã®ä»–</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="persona-occupation">è·æ¥­</label>
                        <input type="text" id="persona-occupation" placeholder="ä¾‹: ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢" class="persona-input">
                    </div>

                    <div class="form-group">
                        <label for="persona-background">èƒŒæ™¯æƒ…å ±</label>
                        <textarea id="persona-background" rows="6" 
                                placeholder="æˆè‚²æ­´ã€ç”Ÿæ´»èƒŒæ™¯ã®è©³ç´°è¨˜è¿°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." 
                                class="persona-input"></textarea>
                        <div class="form-help">ã“ã®ãƒšãƒ«ã‚½ãƒŠã®ç”Ÿè‚²æ­´ã€æ•™è‚²èƒŒæ™¯ã€é‡è¦ãªäººç”Ÿä½“é¨“ãªã©ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚</div>
                    </div>
                </div>
            </div>

            <!-- Personality Tab -->
            <div id="personality-tab" class="tab-panel">
                <div class="card">
                    <h2 class="card-title">BigFiveæ€§æ ¼ç‰¹æ€§</h2>
                    
                    <div class="form-group">
                        <label for="openness-slider">é–‹æ”¾æ€§ (Openness)</label>
                        <div class="slider-container">
                            <input type="range" id="openness-slider" class="slider-input" min="0" max="100" value="50">
                            <span class="slider-value">50%</span>
                        </div>
                        <div class="form-help">æ–°ã—ã„çµŒé¨“ã‚„æ¦‚å¿µã¸ã®å—å®¹æ€§</div>
                    </div>

                    <div class="form-group">
                        <label for="conscientiousness-slider">èª å®Ÿæ€§ (Conscientiousness)</label>
                        <div class="slider-container">
                            <input type="range" id="conscientiousness-slider" class="slider-input" min="0" max="100" value="50">
                            <span class="slider-value">50%</span>
                        </div>
                        <div class="form-help">è¨ˆç”»æ€§ã‚„è²¬ä»»æ„Ÿ</div>
                    </div>

                    <div class="form-group">
                        <label for="extraversion-slider">å¤–å‘æ€§ (Extraversion)</label>
                        <div class="slider-container">
                            <input type="range" id="extraversion-slider" class="slider-input" min="0" max="100" value="50">
                            <span class="slider-value">50%</span>
                        </div>
                        <div class="form-help">ç¤¾äº¤æ€§ã‚„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å¤–å‘çš„ç™ºæ•£</div>
                    </div>

                    <div class="form-group">
                        <label for="agreeableness-slider">å”èª¿æ€§ (Agreeableness)</label>
                        <div class="slider-container">
                            <input type="range" id="agreeableness-slider" class="slider-input" min="0" max="100" value="50">
                            <span class="slider-value">50%</span>
                        </div>
                        <div class="form-help">ä»–è€…ã¸ã®æ€ã„ã‚„ã‚Šã‚„å”åŠ›</div>
                    </div>

                    <div class="form-group">
                        <label for="neuroticism-slider">ç¥çµŒç—‡çš„å‚¾å‘ (Neuroticism)</label>
                        <div class="slider-container">
                            <input type="range" id="neuroticism-slider" class="slider-input" min="0" max="100" value="50">
                            <span class="slider-value">50%</span>
                        </div>
                        <div class="form-help">æ„Ÿæƒ…ã®ä¸å®‰å®šã•ã‚„ã‚¹ãƒˆãƒ¬ã‚¹åå¿œ</div>
                    </div>
                </div>
            </div>

            <!-- Emotions Tab -->
            <div id="emotions-tab" class="tab-panel">
                <div class="card">
                    <h2 class="card-title">æ„Ÿæƒ…ã‚·ã‚¹ãƒ†ãƒ  (Ekmanãƒ¢ãƒ‡ãƒ«)</h2>
                    
                    <div class="form-group">
                        <label for="joy-slider">å–œã³ (Joy)</label>
                        <div class="slider-container">
                            <input type="range" id="joy-slider" class="slider-input" min="0" max="100" value="50">
                            <span class="slider-value">50</span>
                        </div>
                        <div class="form-help">å¹¸ç¦æ„Ÿã€æº€è¶³æ„Ÿ</div>
                    </div>

                    <div class="form-group">
                        <label for="sadness-slider">æ‚²ã—ã¿ (Sadness)</label>
                        <div class="slider-container">
                            <input type="range" id="sadness-slider" class="slider-input" min="0" max="100" value="30">
                            <span class="slider-value">30</span>
                        </div>
                        <div class="form-help">æ‚²ã—ã¿ã€å¤±æœ›æ„Ÿ</div>
                    </div>

                    <div class="form-group">
                        <label for="anger-slider">æ€’ã‚Š (Anger)</label>
                        <div class="slider-container">
                            <input type="range" id="anger-slider" class="slider-input" min="0" max="100" value="25">
                            <span class="slider-value">25</span>
                        </div>
                        <div class="form-help">æ€’ã‚Šã€ã„ã‚‰ã ã¡</div>
                    </div>

                    <div class="form-group">
                        <label for="fear-slider">æã‚Œ (Fear)</label>
                        <div class="slider-container">
                            <input type="range" id="fear-slider" class="slider-input" min="0" max="100" value="40">
                            <span class="slider-value">40</span>
                        </div>
                        <div class="form-help">æã‚Œã€ä¸å®‰</div>
                    </div>

                    <div class="form-group">
                        <label for="disgust-slider">å«Œæ‚ª (Disgust)</label>
                        <div class="slider-container">
                            <input type="range" id="disgust-slider" class="slider-input" min="0" max="100" value="20">
                            <span class="slider-value">20</span>
                        </div>
                        <div class="form-help">å«Œæ‚ªã€ä¸å¿«æ„Ÿ</div>
                    </div>

                    <div class="form-group">
                        <label for="surprise-slider">é©šã (Surprise)</label>
                        <div class="slider-container">
                            <input type="range" id="surprise-slider" class="slider-input" min="0" max="100" value="55">
                            <span class="slider-value">55</span>
                        </div>
                        <div class="form-help">é©šãã€æ„å¤–æ€§ã¸ã®åå¿œ</div>
                    </div>
                </div>
            </div>

            <!-- Associations Tab -->
            <div id="associations-tab" class="tab-panel">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">é–¢é€£æ€§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</h2>
                        <div class="header-buttons">
                            <button class="btn btn--secondary" onclick="app.openTemplateModal()">
                                ğŸ“‹ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                            </button>
                            <button class="btn btn--primary" onclick="app.openAssociationModal()">
                                â• æ–°è¦è¿½åŠ 
                            </button>
                        </div>
                    </div>
                    
                    <!-- é–¢é€£æ€§ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
                    <div class="associations-table-container">
                        <table class="associations-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>ãƒˆãƒªã‚¬ãƒ¼</th>
                                    <th>ãƒ¬ã‚¹ãƒãƒ³ã‚¹</th>
                                    <th>å¼·åº¦</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="associations-tbody">
                                <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ç©ºã®çŠ¶æ…‹ -->
                    <div id="associations-empty" class="empty-state">
                        <p>é–¢é€£æ€§ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                        <button class="btn btn--secondary" onclick="app.openAssociationModal()">
                            æœ€åˆã®é–¢é€£æ€§ã‚’è¿½åŠ 
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview Tab -->
            <div id="preview-tab" class="tab-panel">
                <div class="card">
                    <h2 class="card-title">YAMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                    <div id="yaml-preview" class="preview-container">
# ã“ã“ã«YAMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                    </div>
                </div>
            </div>
        </main>

        <!-- Hidden File Input -->
        <input type="file" id="file-input" class="file-input" accept=".yaml,.yml" />
        
        <!-- Association Edit Modal -->
        <div id="association-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>é–¢é€£æ€§ã®ç·¨é›†</h3>
                    <button class="modal-close" onclick="app.closeAssociationModal()">âœ•</button>
                </div>
                <div class="modal-body">
                    <div class="form-steps">
                        <!-- Step 1: Trigger Type Selection -->
                        <div class="step active" data-step="1">
                            <h4>ã‚¹ãƒ†ãƒƒãƒ—1: ãƒˆãƒªã‚¬ãƒ¼ã‚¿ã‚¤ãƒ—é¸æŠ</h4>
                            <div class="trigger-type-selection">
                                <label class="radio-card">
                                    <input type="radio" name="triggerType" value="external">
                                    <div class="radio-card-content">
                                        <strong>ğŸ·ï¸ å¤–éƒ¨ãƒˆãƒªã‚¬ãƒ¼</strong>
                                        <small>ä¼šè©±ãƒˆãƒ”ãƒƒã‚¯ã‚„å˜èª</small>
                                    </div>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="triggerType" value="emotion">
                                    <div class="radio-card-content">
                                        <strong>ğŸ˜Š æ„Ÿæƒ…ãƒˆãƒªã‚¬ãƒ¼</strong>
                                        <small>æ„Ÿæƒ…çŠ¶æ…‹ã®é–¾å€¤</small>
                                    </div>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="triggerType" value="memory">
                                    <div class="radio-card-content">
                                        <strong>ğŸ’­ è¨˜æ†¶ãƒˆãƒªã‚¬ãƒ¼</strong>
                                        <small>ç‰¹å®šã®è¨˜æ†¶</small>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Step 2: Trigger Details -->
                        <div class="step" data-step="2">
                            <h4>ã‚¹ãƒ†ãƒƒãƒ—2: ãƒˆãƒªã‚¬ãƒ¼è©³ç´°è¨­å®š</h4>
                            <div id="trigger-details">
                                <!-- é¸æŠã•ã‚ŒãŸã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦å‹•çš„ã«å¤‰æ›´ -->
                            </div>
                        </div>
                        
                        <!-- Step 3: Response Settings -->
                        <div class="step" data-step="3">
                            <h4>ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¨­å®š</h4>
                            <div class="form-group">
                                <label for="responseType">ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ—</label>
                                <select id="responseType">
                                    <option value="memory">è¨˜æ†¶</option>
                                    <option value="emotion">æ„Ÿæƒ…</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="responseTarget">å¯¾è±¡</label>
                                <select id="responseTarget">
                                    <!-- é¸æŠã•ã‚ŒãŸã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦å‹•çš„ã«å¤‰æ›´ -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- Step 4: Association Strength -->
                        <div class="step" data-step="4">
                            <h4>ã‚¹ãƒ†ãƒƒãƒ—4: é–¢é€£å¼·åº¦è¨­å®š</h4>
                            <div class="form-group">
                                <label for="association-strength">é–¢é€£å¼·åº¦</label>
                                <div class="slider-container">
                                    <input type="range" id="association-strength" 
                                           class="slider-input" min="0" max="100" value="70">
                                    <span class="slider-value">70</span>
                                </div>
                                <div class="strength-guide">
                                    <small>
                                        <strong>0-30:</strong> å¼±ã„é–¢é€£ |
                                        <strong>31-70:</strong> ä¸­ç¨‹åº¦ |
                                        <strong>71-100:</strong> å¼·ã„é–¢é€£
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" id="prev-step-btn" onclick="app.previousStep()" style="display: none;">â† å‰ã¸</button>
                    <button class="btn btn--primary" id="next-step-btn" onclick="app.nextStep()">æ¬¡ã¸ â†’</button>
                    <button class="btn btn--success" id="save-association-btn" onclick="app.saveAssociation()" style="display: none;">
                        ğŸ’¾ ä¿å­˜
                    </button>
                    <button class="btn btn--secondary" onclick="app.closeAssociationModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
        </div>
        
        <!-- Association Template Modal -->
        <div id="template-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>é–¢é€£æ€§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ</h3>
                    <button class="modal-close" onclick="app.closeTemplateModal()">âœ•</button>
                </div>
                <div class="modal-body">
                    <p>å…¸å‹çš„ãªé–¢é€£æ€§ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰é¸æŠã—ã¦ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™</p>
                    <div class="template-grid" id="template-grid">
                        <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" onclick="app.closeTemplateModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
        </div>
    </div>

    <!-- js-yaml CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    
    <script>
        // PersonaData ã‚¯ãƒ©ã‚¹
        class PersonaData {
            constructor() {
                this.data = this.getDefaultData();
            }

            getDefaultData() {
                return {
                    personal_info: {
                        name: "",
                        age: null,
                        gender: "",
                        occupation: ""
                    },
                    background: "",
                    personality: {
                        model: "BigFive",
                        traits: {
                            openness: 0.5,
                            conscientiousness: 0.5,
                            extraversion: 0.5,
                            agreeableness: 0.5,
                            neuroticism: 0.5
                        }
                    },
                    emotion_system: {
                        model: "Ekman",
                        emotions: {
                            joy: { baseline: 50, description: "å¹¸ç¦æ„Ÿã€æº€è¶³æ„Ÿ" },
                            sadness: { baseline: 30, description: "æ‚²ã—ã¿ã€å¤±æœ›æ„Ÿ" },
                            anger: { baseline: 25, description: "æ€’ã‚Šã€ã„ã‚‰ã ã¡" },
                            fear: { baseline: 40, description: "æã‚Œã€ä¸å®‰" },
                            disgust: { baseline: 20, description: "å«Œæ‚ªã€ä¸å¿«æ„Ÿ" },
                            surprise: { baseline: 55, description: "é©šãã€æ„å¤–æ€§ã¸ã®åå¿œ" }
                        }
                    },
                    memory_system: {
                        memories: [
                            {
                                id: "childhood_nature",
                                type: "episodic",
                                content: "å­ä¾›ã®é ƒã«æ£®ã§è¦‹ã¤ã‘ãŸçã—ã„æ˜†è™«ã‚’è¦³å¯Ÿã—ãŸçµŒé¨“",
                                period: "Childhood (Age 8)",
                                emotional_valence: "positive",
                                associated_emotions: ["joy", "curiosity"]
                            },
                            {
                                id: "first_research",
                                type: "episodic", 
                                content: "åˆã‚ã¦ç ”ç©¶è«–æ–‡ã‚’ç™ºè¡¨ã—ãŸã¨ãã®é”æˆæ„Ÿã¨ç·Šå¼µ",
                                period: "Graduate School (Age 24)",
                                emotional_valence: "positive",
                                associated_emotions: ["joy", "fear"]
                            }
                        ]
                    },
                    association_system: {
                        associations: []
                    }
                };
            }

            getData() {
                return this.data;
            }

            setData(newData) {
                this.data = { ...this.data, ...newData };
                this.notifyChange();
            }

            updatePersonalInfo(info) {
                this.data.personal_info = { ...this.data.personal_info, ...info };
                this.notifyChange();
            }

            updatePersonality(traits) {
                this.data.personality.traits = { ...this.data.personality.traits, ...traits };
                this.notifyChange();
            }

            updateEmotionSystem(emotions) {
                Object.keys(emotions).forEach(emotion => {
                    if (this.data.emotion_system.emotions[emotion]) {
                        this.data.emotion_system.emotions[emotion].baseline = emotions[emotion];
                    }
                });
                this.notifyChange();
            }

            updateBackground(background) {
                this.data.background = background;
                this.notifyChange();
            }

            addAssociation(association) {
                association.id = Date.now(); // ç°¡æ˜“IDç”Ÿæˆ
                this.data.association_system.associations.push(association);
                this.notifyChange();
            }

            updateAssociation(id, updates) {
                const index = this.data.association_system.associations.findIndex(a => a.id === id);
                if (index !== -1) {
                    this.data.association_system.associations[index] = { 
                        ...this.data.association_system.associations[index], 
                        ...updates 
                    };
                    this.notifyChange();
                }
            }

            deleteAssociation(id) {
                this.data.association_system.associations = 
                    this.data.association_system.associations.filter(a => a.id !== id);
                this.notifyChange();
            }

            getAssociations() {
                return this.data.association_system.associations;
            }

            getMemoryIds() {
                return this.data.memory_system.memories.map(m => m.id).filter(id => id);
            }

            getEmotionIds() {
                const emotions = this.data.emotion_system.emotions;
                const additionalEmotions = this.data.emotion_system.additional_emotions || {};
                return [...Object.keys(emotions), ...Object.keys(additionalEmotions)];
            }

            reset() {
                this.data = this.getDefaultData();
                this.notifyChange();
            }

            toYAML() {
                // æ•°å€¤ã‚’é©åˆ‡ãªå½¢å¼ã«å¤‰æ›
                const outputData = JSON.parse(JSON.stringify(this.data));
                
                // æ€§æ ¼ç‰¹æ€§ã‚’0-1ã®ç¯„å›²ã«å¤‰æ›
                Object.keys(outputData.personality.traits).forEach(trait => {
                    outputData.personality.traits[trait] = outputData.personality.traits[trait] / 100;
                });

                return jsyaml.dump(outputData, {
                    lineWidth: -1,
                    noRefs: true,
                    sortKeys: false
                });
            }

            fromYAML(yamlString) {
                try {
                    const parsedData = jsyaml.load(yamlString);
                    
                    // æ€§æ ¼ç‰¹æ€§ã‚’0-100ã®ç¯„å›²ã«å¤‰æ›
                    if (parsedData.personality && parsedData.personality.traits) {
                        Object.keys(parsedData.personality.traits).forEach(trait => {
                            parsedData.personality.traits[trait] = parsedData.personality.traits[trait] * 100;
                        });
                    }

                    this.data = { ...this.getDefaultData(), ...parsedData };
                    this.notifyChange();
                    return true;
                } catch (error) {
                    console.error('YAML parse error:', error);
                    return false;
                }
            }

            notifyChange() {
                const event = new CustomEvent('personaDataChanged', {
                    detail: { data: this.data }
                });
                document.dispatchEvent(event);
            }
        }

        // UIController ã‚¯ãƒ©ã‚¹
        class UIController {
            constructor(personaData) {
                this.personaData = personaData;
                this.initializeUI();
                this.bindEvents();
            }

            initializeUI() {
                this.updateAllUI();
            }

            bindEvents() {
                // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
                document.addEventListener('click', (e) => {
                    if (e.target.matches('.tab-btn')) {
                        this.showTab(e.target.dataset.tab);
                    }
                });

                // ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
                document.addEventListener('input', (e) => {
                    if (e.target.matches('.persona-input')) {
                        this.handlePersonalInfoChange(e);
                    } else if (e.target.matches('.slider-input')) {
                        this.handleSliderChange(e);
                    }
                });

                // ãƒ‡ãƒ¼ã‚¿å¤‰æ›´é€šçŸ¥ã‚’å—ä¿¡
                document.addEventListener('personaDataChanged', () => {
                    this.updateAllUI();
                });
            }

            showTab(tabName) {
                // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ãƒ‘ãƒãƒ«ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));

                // æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.querySelector(`#${tabName}-tab`).classList.add('active');

                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ–ã®å ´åˆã¯æ›´æ–°
                if (tabName === 'preview') {
                    this.updatePreview();
                }
            }

            handlePersonalInfoChange(e) {
                const { id, value } = e.target;
                
                if (id === 'persona-name') {
                    this.personaData.updatePersonalInfo({ name: value });
                } else if (id === 'persona-age') {
                    this.personaData.updatePersonalInfo({ age: value ? parseInt(value) : null });
                } else if (id === 'persona-gender') {
                    this.personaData.updatePersonalInfo({ gender: value });
                } else if (id === 'persona-occupation') {
                    this.personaData.updatePersonalInfo({ occupation: value });
                } else if (id === 'persona-background') {
                    this.personaData.updateBackground(value);
                }
            }

            handleSliderChange(e) {
                const { id, value } = e.target;
                const numValue = parseInt(value);

                // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å€¤è¡¨ç¤ºã‚’æ›´æ–°
                const valueDisplay = e.target.parentNode.querySelector('.slider-value');
                
                if (id.includes('-slider')) {
                    const traitName = id.replace('-slider', '');
                    
                    if (['openness', 'conscientiousness', 'extraversion', 'agreeableness', 'neuroticism'].includes(traitName)) {
                        valueDisplay.textContent = numValue + '%';
                        this.personaData.updatePersonality({ [traitName]: numValue });
                    } else if (['joy', 'sadness', 'anger', 'fear', 'disgust', 'surprise'].includes(traitName)) {
                        valueDisplay.textContent = numValue.toString();
                        this.personaData.updateEmotionSystem({ [traitName]: numValue });
                    }
                }
            }

            updateAllUI() {
                const data = this.personaData.getData();
                this.updatePersonalInfoUI(data);
                this.updatePersonalityUI(data);
                this.updateEmotionSystemUI(data);
                this.updateAssociationsUI(data);
            }

            updatePersonalInfoUI(data) {
                document.getElementById('persona-name').value = data.personal_info.name || '';
                document.getElementById('persona-age').value = data.personal_info.age || '';
                document.getElementById('persona-gender').value = data.personal_info.gender || '';
                document.getElementById('persona-occupation').value = data.personal_info.occupation || '';
                document.getElementById('persona-background').value = data.background || '';
            }

            updatePersonalityUI(data) {
                const traits = data.personality.traits;
                Object.keys(traits).forEach(trait => {
                    const slider = document.getElementById(`${trait}-slider`);
                    const valueDisplay = slider.parentNode.querySelector('.slider-value');
                    slider.value = traits[trait];
                    valueDisplay.textContent = Math.round(traits[trait]) + '%';
                });
            }

            updateEmotionSystemUI(data) {
                const emotions = data.emotion_system.emotions;
                Object.keys(emotions).forEach(emotion => {
                    const slider = document.getElementById(`${emotion}-slider`);
                    const valueDisplay = slider.parentNode.querySelector('.slider-value');
                    slider.value = emotions[emotion].baseline;
                    valueDisplay.textContent = emotions[emotion].baseline.toString();
                });
            }

            updateAssociationsUI(data) {
                const associations = data.association_system.associations;
                const tbody = document.getElementById('associations-tbody');
                const emptyState = document.getElementById('associations-empty');
                
                if (associations.length === 0) {
                    tbody.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                tbody.innerHTML = associations.map((assoc, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${this.renderTrigger(assoc.trigger)}</td>
                        <td>${this.renderResponse(assoc.response)}</td>
                        <td>${this.renderStrength(assoc.response.association_strength)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" onclick="app.editAssociation(${assoc.id})" title="ç·¨é›†">
                                    âœï¸
                                </button>
                                <button class="btn-icon" onclick="app.deleteAssociation(${assoc.id})" title="å‰Šé™¤">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderTrigger(trigger) {
                if (trigger.type === 'external') {
                    const items = trigger.items ? trigger.items.slice(0, 3).join(', ') : '';
                    const more = trigger.items && trigger.items.length > 3 ? '...' : '';
                    return `
                        <div class="trigger-display">
                            <span class="trigger-type-icon">ğŸ·ï¸</span>
                            <div>
                                <div class="trigger-details">[${items}${more}]</div>
                            </div>
                        </div>
                    `;
                } else if (trigger.type === 'emotion') {
                    return `
                        <div class="trigger-display">
                            <span class="trigger-type-icon">ğŸ˜Š</span>
                            <div>
                                <div>${trigger.id}</div>
                                <div class="trigger-details">â‰¥ ${trigger.threshold}</div>
                            </div>
                        </div>
                    `;
                } else if (trigger.type === 'memory') {
                    return `
                        <div class="trigger-display">
                            <span class="trigger-type-icon">ğŸ’­</span>
                            <div>
                                <div>${trigger.id}</div>
                            </div>
                        </div>
                    `;
                }
                return 'Unknown';
            }

            renderResponse(response) {
                const icon = response.type === 'memory' ? 'ğŸ’­' : 'ğŸ˜Š';
                return `
                    <div class="response-display">
                        <span class="response-type-icon">${icon}</span>
                        <div>${response.id}</div>
                    </div>
                `;
            }

            renderStrength(strength) {
                const bars = Math.floor(strength / 10);
                const filled = 'â– '.repeat(bars);
                const empty = 'â–¡'.repeat(10 - bars);
                return `<div class="strength-bar">${filled}${empty} ${strength}</div>`;
            }

            updatePreview() {
                const yamlContent = this.personaData.toYAML();
                document.getElementById('yaml-preview').textContent = yamlContent;
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification notification--${type}`;
                notification.textContent = message;
                
                const container = document.getElementById('notifications');
                container.appendChild(notification);

                setTimeout(() => {
                    container.removeChild(notification);
                }, 5000);
            }
        }

        // FileHandler ã‚¯ãƒ©ã‚¹
        class FileHandler {
            constructor(personaData, uiController) {
                this.personaData = personaData;
                this.uiController = uiController;
            }

            async loadFile() {
                return new Promise((resolve) => {
                    const input = document.getElementById('file-input');
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const content = e.target.result;
                                if (this.personaData.fromYAML(content)) {
                                    this.uiController.showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
                                    resolve(true);
                                } else {
                                    this.uiController.showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                                    resolve(false);
                                }
                            };
                            reader.readAsText(file);
                        }
                    };
                    input.click();
                });
            }

            saveFile(filename = 'persona.yaml') {
                const yamlContent = this.personaData.toYAML();
                const blob = new Blob([yamlContent], { type: 'text/yaml' });
                const url = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                this.uiController.showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
            }
        }

        // App ã‚¯ãƒ©ã‚¹
        class App {
            constructor() {
                this.personaData = new PersonaData();
                this.uiController = new UIController(this.personaData);
                this.fileHandler = new FileHandler(this.personaData, this.uiController);
                this.currentStep = 1;
                this.editingAssociationId = null;
                this.associationFormData = {};
                this.initializeAssociationModal();
                this.initializeTemplates();
            }

            initializeAssociationModal() {
                // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®å¤‰æ›´ã‚’ç›£è¦–
                document.addEventListener('change', (e) => {
                    if (e.target.name === 'triggerType') {
                        this.updateTriggerDetails(e.target.value);
                    } else if (e.target.id === 'responseType') {
                        this.updateResponseTargets(e.target.value);
                    }
                });

                // é–¢é€£å¼·åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ç›£è¦–
                document.addEventListener('input', (e) => {
                    if (e.target.id === 'association-strength') {
                        const valueDisplay = e.target.parentNode.querySelector('.slider-value');
                        valueDisplay.textContent = e.target.value;
                    }
                });

                // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'association-modal') {
                        this.closeAssociationModal();
                    }
                    if (e.target.id === 'template-modal') {
                        this.closeTemplateModal();
                    }
                });
            }

            initializeTemplates() {
                this.templates = [
                    {
                        id: 'trauma_memory',
                        icon: 'âš ï¸',
                        title: 'ãƒˆãƒ©ã‚¦ãƒçš„è¨˜æ†¶',
                        description: 'ç‰¹å®šã®è©±é¡ŒãŒä¸å®‰ã‚„ææ€–æ„Ÿæƒ…ã‚’å¼•ãèµ·ã“ã™é–¢é€£æ€§',
                        category: 'ãƒã‚¬ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['äº‹æ•…', 'ç—…é™¢', 'ç—›ã¿']
                            },
                            response: {
                                type: 'emotion',
                                id: 'fear',
                                association_strength: 85
                            }
                        }
                    },
                    {
                        id: 'warm_childhood',
                        icon: 'ğŸŒ¸',
                        title: 'ã»ã®ã¼ã®ã—ãŸæ€ã„å‡º',
                        description: 'å­ä¾›æ™‚ä»£ã®æ¸©ã‹ã„è¨˜æ†¶ãŒå–œã³ã®æ„Ÿæƒ…ã‚’å‘¼ã³èµ·ã“ã™',
                        category: 'ãƒã‚¸ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['å­ä¾›æ™‚ä»£', 'å®¶æ—', 'éŠã³']
                            },
                            response: {
                                type: 'emotion',
                                id: 'joy',
                                association_strength: 75
                            }
                        }
                    },
                    {
                        id: 'achievement_pride',
                        icon: 'ğŸ†',
                        title: 'é”æˆä½“é¨“',
                        description: 'æˆåŠŸã‚„é”æˆã®è©±é¡ŒãŒèª‡ã‚Šã‚„è‡ªä¿¡ã‚’å‘¼ã³èµ·ã“ã™',
                        category: 'ãƒã‚¸ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['æˆåŠŸ', 'é”æˆ', 'è³']
                            },
                            response: {
                                type: 'emotion',
                                id: 'joy',
                                association_strength: 80
                            }
                        }
                    },
                    {
                        id: 'failure_shame',
                        icon: 'ğŸ˜',
                        title: 'å¤±æ•—ä½“é¨“',
                        description: 'å¤±æ•—ã‚„æŒ«æŠ˜ã®è©±é¡ŒãŒæ¥ãšã‹ã—ã•ã‚„æ‚²ã—ã¿ã‚’å¼•ãèµ·ã“ã™',
                        category: 'ãƒã‚¬ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['å¤±æ•—', 'æŒ«æŠ˜', 'ãƒŸã‚¹']
                            },
                            response: {
                                type: 'emotion',
                                id: 'sadness',
                                association_strength: 70
                            }
                        }
                    },
                    {
                        id: 'nature_peace',
                        icon: 'ğŸŒ²',
                        title: 'è‡ªç„¶ã¸ã®æ„›ç€',
                        description: 'è‡ªç„¶ã«é–¢ã™ã‚‹è©±é¡ŒãŒå¹³ç©ã‚„å–œã³ã‚’ã‚‚ãŸã‚‰ã™',
                        category: 'ãƒã‚¸ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['è‡ªç„¶', 'æ£®', 'å±±', 'æµ·']
                            },
                            response: {
                                type: 'emotion',
                                id: 'joy',
                                association_strength: 65
                            }
                        }
                    },
                    {
                        id: 'social_anxiety',
                        icon: 'ğŸ˜°',
                        title: 'ç¤¾äº¤ä¸å®‰',
                        description: 'äººã¨ã®æ¥è§¦ã‚„è©•ä¾¡å ´é¢ã§ä¸å®‰ãŒé«˜ã¾ã‚‹',
                        category: 'ãƒã‚¬ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['ç™ºè¡¨', 'äººå‰', 'è©•ä¾¡', 'è¦–ç·š']
                            },
                            response: {
                                type: 'emotion',
                                id: 'fear',
                                association_strength: 80
                            }
                        }
                    },
                    {
                        id: 'art_inspiration',
                        icon: 'ğŸ¨',
                        title: 'èŠ¸è¡“çš„æ„Ÿæ€§',
                        description: 'èŠ¸è¡“ã‚„ç¾ã«è§¦ã‚Œã‚‹ã¨æ„Ÿå‹•ã‚„å‰µé€ æ€§ãŒæ¹§ã',
                        category: 'ãƒã‚¸ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['éŸ³æ¥½', 'çµµç”»', 'è©©', 'ç¾']
                            },
                            response: {
                                type: 'emotion',
                                id: 'surprise',
                                association_strength: 70
                            }
                        }
                    },
                    {
                        id: 'loss_grief',
                        icon: 'ğŸ’”',
                        title: 'å–ªå¤±ä½“é¨“',
                        description: 'åˆ¥ã‚Œã‚„å–ªå¤±ã®è©±é¡ŒãŒæ·±ã„æ‚²ã—ã¿ã‚’å‘¼ã³èµ·ã“ã™',
                        category: 'ãƒã‚¬ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['åˆ¥ã‚Œ', 'æ­»', 'å–ªå¤±', 'ã•ã‚ˆãªã‚‰']
                            },
                            response: {
                                type: 'emotion',
                                id: 'sadness',
                                association_strength: 90
                            }
                        }
                    },
                    {
                        id: 'learning_curiosity',
                        icon: 'ğŸ“š',
                        title: 'å­¦ç¿’ã¸ã®èˆˆå‘³',
                        description: 'çŸ¥è­˜ã‚„å­¦ç¿’ã®è©±é¡ŒãŒå¥½å¥‡å¿ƒã‚’åˆºæ¿€ã™ã‚‹',
                        category: 'ãƒã‚¸ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['å­¦ç¿’', 'çŸ¥è­˜', 'ç™ºè¦‹', 'ç ”ç©¶']
                            },
                            response: {
                                type: 'emotion',
                                id: 'surprise',
                                association_strength: 75
                            }
                        }
                    },
                    {
                        id: 'injustice_anger',
                        icon: 'ğŸ˜ ',
                        title: 'ä¸å…¬å¹³ã¸ã®æ†¤ã‚Š',
                        description: 'ä¸å…¬å¹³ã‚„ä¸æ­£ã®è©±é¡ŒãŒæ€’ã‚Šã‚’å¼•ãèµ·ã“ã™',
                        category: 'ãƒã‚¬ãƒ†ã‚£ãƒ–',
                        template: {
                            trigger: {
                                type: 'external',
                                category: 'topics',
                                items: ['ä¸å…¬å¹³', 'ä¸æ­£', 'å·®åˆ¥', 'ã„ã˜ã‚']
                            },
                            response: {
                                type: 'emotion',
                                id: 'anger',
                                association_strength: 85
                            }
                        }
                    }
                ];
            }

            handleNewPersona() {
                if (confirm('æ–°ã—ã„ãƒšãƒ«ã‚½ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚ç¾åœ¨ã®å†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ãŒã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    this.personaData.reset();
                    this.uiController.showNotification('æ–°ã—ã„ãƒšãƒ«ã‚½ãƒŠã‚’ä½œæˆã—ã¾ã—ãŸ', 'success');
                }
            }

            async handleLoadFile() {
                await this.fileHandler.loadFile();
            }

            handleSaveFile() {
                const personaName = this.personaData.getData().personal_info.name;
                const filename = personaName ? `${personaName.replace(/\s+/g, '_')}.yaml` : 'persona.yaml';
                this.fileHandler.saveFile(filename);
            }

            // é–¢é€£æ€§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç·¨é›†ãƒ¡ã‚½ãƒƒãƒ‰
            openAssociationModal(associationId = null) {
                this.editingAssociationId = associationId;
                this.currentStep = 1;
                this.associationFormData = {};
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
                const modal = document.getElementById('association-modal');
                modal.classList.add('show');
                
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
                this.resetAssociationForm();
                this.updateStepDisplay();
                
                if (associationId) {
                    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                    this.loadAssociationData(associationId);
                }
            }

            closeAssociationModal() {
                const modal = document.getElementById('association-modal');
                modal.classList.remove('show');
                this.resetAssociationForm();
            }

            resetAssociationForm() {
                // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãƒªã‚»ãƒƒãƒˆ
                document.querySelectorAll('input[name="triggerType"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // ãƒˆãƒªã‚¬ãƒ¼è©³ç´°ã‚¯ãƒªã‚¢
                document.getElementById('trigger-details').innerHTML = '';
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¨­å®šãƒªã‚»ãƒƒãƒˆ
                document.getElementById('responseType').value = 'memory';
                document.getElementById('responseTarget').innerHTML = '';
                
                // é–¢é€£å¼·åº¦ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('association-strength').value = 70;
                document.querySelector('#association-strength').parentNode.querySelector('.slider-value').textContent = '70';
                
                this.currentStep = 1;
                this.updateStepDisplay();
            }

            updateStepDisplay() {
                // ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });
                document.querySelector(`[data-step="${this.currentStep}"]`).classList.add('active');
                
                // ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
                const prevBtn = document.getElementById('prev-step-btn');
                const nextBtn = document.getElementById('next-step-btn');
                const saveBtn = document.getElementById('save-association-btn');
                
                prevBtn.style.display = this.currentStep > 1 ? 'block' : 'none';
                nextBtn.style.display = this.currentStep < 4 ? 'block' : 'none';
                saveBtn.style.display = this.currentStep === 4 ? 'block' : 'none';
            }

            nextStep() {
                if (this.validateCurrentStep()) {
                    this.saveCurrentStepData();
                    if (this.currentStep < 4) {
                        this.currentStep++;
                        this.updateStepDisplay();
                        
                        if (this.currentStep === 3) {
                            this.updateResponseTargets(document.getElementById('responseType').value);
                        }
                    }
                }
            }

            previousStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.updateStepDisplay();
                }
            }

            validateCurrentStep() {
                switch (this.currentStep) {
                    case 1:
                        const triggerType = document.querySelector('input[name="triggerType"]:checked');
                        if (!triggerType) {
                            this.uiController.showNotification('ãƒˆãƒªã‚¬ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                            return false;
                        }
                        return true;
                    case 2:
                        return this.validateTriggerDetails();
                    case 3:
                        const responseTarget = document.getElementById('responseTarget').value;
                        if (!responseTarget) {
                            this.uiController.showNotification('ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¯¾è±¡ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                            return false;
                        }
                        return true;
                    default:
                        return true;
                }
            }

            validateTriggerDetails() {
                const triggerType = this.associationFormData.triggerType;
                
                if (triggerType === 'external') {
                    const items = document.getElementById('external-items')?.value;
                    if (!items || !items.trim()) {
                        this.uiController.showNotification('ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
                        return false;
                    }
                } else if (triggerType === 'emotion') {
                    const emotionTarget = document.getElementById('emotion-target')?.value;
                    if (!emotionTarget) {
                        this.uiController.showNotification('å¯¾è±¡æ„Ÿæƒ…ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                        return false;
                    }
                } else if (triggerType === 'memory') {
                    const memoryTarget = document.getElementById('memory-target')?.value;
                    if (!memoryTarget) {
                        this.uiController.showNotification('å¯¾è±¡è¨˜æ†¶ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                        return false;
                    }
                }
                
                return true;
            }

            saveCurrentStepData() {
                switch (this.currentStep) {
                    case 1:
                        this.associationFormData.triggerType = document.querySelector('input[name="triggerType"]:checked').value;
                        break;
                    case 2:
                        this.saveTriggerDetails();
                        break;
                    case 3:
                        this.associationFormData.responseType = document.getElementById('responseType').value;
                        this.associationFormData.responseTarget = document.getElementById('responseTarget').value;
                        break;
                    case 4:
                        this.associationFormData.associationStrength = parseInt(document.getElementById('association-strength').value);
                        break;
                }
            }

            saveTriggerDetails() {
                const triggerType = this.associationFormData.triggerType;
                
                if (triggerType === 'external') {
                    const category = document.getElementById('external-category')?.value || 'topics';
                    const items = document.getElementById('external-items').value
                        .split(',').map(item => item.trim()).filter(item => item);
                    
                    this.associationFormData.trigger = {
                        type: 'external',
                        category: category,
                        items: items
                    };
                } else if (triggerType === 'emotion') {
                    const emotionId = document.getElementById('emotion-target').value;
                    const threshold = parseInt(document.getElementById('emotion-threshold').value);
                    
                    this.associationFormData.trigger = {
                        type: 'emotion',
                        id: emotionId,
                        threshold: threshold
                    };
                } else if (triggerType === 'memory') {
                    const memoryId = document.getElementById('memory-target').value;
                    
                    this.associationFormData.trigger = {
                        type: 'memory',
                        id: memoryId
                    };
                }
            }

            updateTriggerDetails(triggerType) {
                const container = document.getElementById('trigger-details');
                
                if (triggerType === 'external') {
                    container.innerHTML = `
                        <div class="external-trigger-form">
                            <div class="form-group">
                                <label for="external-category">ã‚«ãƒ†ã‚´ãƒª</label>
                                <select id="external-category">
                                    <option value="topics">ãƒˆãƒ”ãƒƒã‚¯ãƒ»å˜èª</option>
                                    <option value="interaction_quality">å¯¾è©±ã®é›°å›²æ°—</option>
                                    <option value="context">æ–‡è„ˆæƒ…å ±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="external-items">ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
                                <textarea id="external-items" class="trigger-items-input" 
                                         placeholder="ä¾‹: nature, forest, insects"></textarea>
                                <div class="form-help">
                                    ä¼šè©±ä¸­ã«ã“ã‚Œã‚‰ã®å˜èªãŒå‡ºç¾ã—ãŸã¨ãã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™
                                </div>
                            </div>
                        </div>
                    `;
                } else if (triggerType === 'emotion') {
                    const emotionIds = this.personaData.getEmotionIds();
                    const emotionOptions = emotionIds.map(id => 
                        `<option value="${id}">${id}</option>`
                    ).join('');
                    
                    container.innerHTML = `
                        <div class="emotion-trigger-form">
                            <div class="form-group">
                                <label for="emotion-target">å¯¾è±¡æ„Ÿæƒ…</label>
                                <select id="emotion-target">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    ${emotionOptions}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="emotion-threshold">é–¾å€¤</label>
                                <div class="slider-container">
                                    <input type="range" id="emotion-threshold" 
                                           class="slider-input" min="0" max="100" value="60">
                                    <span class="slider-value">60</span>
                                </div>
                                <div class="form-help">
                                    ã“ã®å€¤ä»¥ä¸Šã«ãªã£ãŸã¨ãã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // é–¾å€¤ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
                    document.getElementById('emotion-threshold').addEventListener('input', (e) => {
                        e.target.parentNode.querySelector('.slider-value').textContent = e.target.value;
                    });
                } else if (triggerType === 'memory') {
                    const memoryIds = this.personaData.getMemoryIds();
                    const memoryOptions = memoryIds.map(id => 
                        `<option value="${id}">${id}</option>`
                    ).join('');
                    
                    container.innerHTML = `
                        <div class="memory-trigger-form">
                            <div class="form-group">
                                <label for="memory-target">å¯¾è±¡è¨˜æ†¶</label>
                                <select id="memory-target">
                                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                    ${memoryOptions}
                                </select>
                            </div>
                            <div class="form-help">
                                ã“ã®è¨˜æ†¶ãŒæƒ³èµ·ã•ã‚ŒãŸã¨ãã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™
                            </div>
                        </div>
                    `;
                }
            }

            updateResponseTargets(responseType) {
                const select = document.getElementById('responseTarget');
                
                if (responseType === 'memory') {
                    const memoryIds = this.personaData.getMemoryIds();
                    select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
                        memoryIds.map(id => `<option value="${id}">${id}</option>`).join('');
                } else if (responseType === 'emotion') {
                    const emotionIds = this.personaData.getEmotionIds();
                    select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
                        emotionIds.map(id => `<option value="${id}">${id}</option>`).join('');
                }
            }

            saveAssociation() {
                this.saveCurrentStepData();
                
                const association = {
                    trigger: this.associationFormData.trigger,
                    response: {
                        type: this.associationFormData.responseType,
                        id: this.associationFormData.responseTarget,
                        association_strength: this.associationFormData.associationStrength
                    }
                };
                
                if (this.editingAssociationId) {
                    this.personaData.updateAssociation(this.editingAssociationId, association);
                    this.uiController.showNotification('é–¢é€£æ€§ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
                } else {
                    this.personaData.addAssociation(association);
                    this.uiController.showNotification('é–¢é€£æ€§ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
                }
                
                this.closeAssociationModal();
            }

            editAssociation(id) {
                this.openAssociationModal(id);
            }

            deleteAssociation(id) {
                if (confirm('ã“ã®é–¢é€£æ€§ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.personaData.deleteAssociation(id);
                    this.uiController.showNotification('é–¢é€£æ€§ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                }
            }

            loadAssociationData(id) {
                const associations = this.personaData.getAssociations();
                const association = associations.find(a => a.id === id);
                
                if (association) {
                    // TODO: ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã®æ—¢å­˜ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Ÿè£…
                    console.log('Loading association for edit:', association);
                }
            }

            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
            openTemplateModal() {
                const modal = document.getElementById('template-modal');
                modal.classList.add('show');
                this.renderTemplateGrid();
            }

            closeTemplateModal() {
                const modal = document.getElementById('template-modal');
                modal.classList.remove('show');
            }

            renderTemplateGrid() {
                const grid = document.getElementById('template-grid');
                grid.innerHTML = this.templates.map(template => `
                    <div class="template-card" onclick="app.selectTemplate('${template.id}')">
                        <div class="template-card-header">
                            <span class="template-icon">${template.icon}</span>
                            <span class="template-title">${template.title}</span>
                        </div>
                        <div class="template-description">
                            ${template.description}
                        </div>
                        <div class="template-preview">
                            ${this.getTemplatePreview(template.template)}
                        </div>
                        <div class="template-tag">${template.category}</div>
                    </div>
                `).join('');
            }

            getTemplatePreview(template) {
                const trigger = template.trigger;
                const response = template.response;
                
                let triggerText = '';
                if (trigger.type === 'external') {
                    triggerText = `ğŸ·ï¸ [${trigger.items.slice(0, 2).join(', ')}...]`;
                } else if (trigger.type === 'emotion') {
                    triggerText = `ğŸ˜Š ${trigger.id} â‰¥ ${trigger.threshold}`;
                } else if (trigger.type === 'memory') {
                    triggerText = `ğŸ’­ ${trigger.id}`;
                }
                
                const responseIcon = response.type === 'memory' ? 'ğŸ’­' : 'ğŸ˜Š';
                const responseText = `${responseIcon} ${response.id}`;
                
                return `${triggerText} â†’ ${responseText} (${response.association_strength})`;
            }

            selectTemplate(templateId) {
                const template = this.templates.find(t => t.id === templateId);
                if (template) {
                    this.closeTemplateModal();
                    this.applyTemplate(template.template);
                }
            }

            applyTemplate(template) {
                // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é–¢é€£æ€§ãƒ•ã‚©ãƒ¼ãƒ ã«é©ç”¨
                this.openAssociationModal();
                
                // ã‚¹ãƒ†ãƒƒãƒ—1: ãƒˆãƒªã‚¬ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’è¨­å®š
                setTimeout(() => {
                    const triggerTypeRadio = document.querySelector(`input[name="triggerType"][value="${template.trigger.type}"]`);
                    if (triggerTypeRadio) {
                        triggerTypeRadio.checked = true;
                        this.updateTriggerDetails(template.trigger.type);
                        
                        // ãƒˆãƒªã‚¬ãƒ¼è©³ç´°ã‚’è¨­å®š
                        setTimeout(() => {
                            this.fillTriggerDetails(template.trigger);
                        }, 100);
                    }
                    
                    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¨­å®š
                    setTimeout(() => {
                        const responseTypeSelect = document.getElementById('responseType');
                        const associationStrengthSlider = document.getElementById('association-strength');
                        
                        if (responseTypeSelect) {
                            responseTypeSelect.value = template.response.type;
                            this.updateResponseTargets(template.response.type);
                            
                            setTimeout(() => {
                                const responseTargetSelect = document.getElementById('responseTarget');
                                if (responseTargetSelect) {
                                    responseTargetSelect.value = template.response.id;
                                }
                            }, 50);
                        }
                        
                        if (associationStrengthSlider) {
                            associationStrengthSlider.value = template.response.association_strength;
                            associationStrengthSlider.parentNode.querySelector('.slider-value').textContent = template.response.association_strength;
                        }
                    }, 150);
                }, 100);
                
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜
                this.associationFormData = {
                    triggerType: template.trigger.type,
                    trigger: template.trigger,
                    responseType: template.response.type,
                    responseTarget: template.response.id,
                    associationStrength: template.response.association_strength
                };
                
                // é€šçŸ¥
                this.uiController.showNotification('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã—ãŸã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã§å†…å®¹ã‚’ç¢ºèªãƒ»èª¿æ•´ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚', 'success');
            }

            fillTriggerDetails(trigger) {
                if (trigger.type === 'external') {
                    const categorySelect = document.getElementById('external-category');
                    const itemsTextarea = document.getElementById('external-items');
                    
                    if (categorySelect && trigger.category) {
                        categorySelect.value = trigger.category;
                    }
                    if (itemsTextarea && trigger.items) {
                        itemsTextarea.value = trigger.items.join(', ');
                    }
                } else if (trigger.type === 'emotion') {
                    const emotionSelect = document.getElementById('emotion-target');
                    const thresholdSlider = document.getElementById('emotion-threshold');
                    
                    if (emotionSelect && trigger.id) {
                        emotionSelect.value = trigger.id;
                    }
                    if (thresholdSlider && trigger.threshold) {
                        thresholdSlider.value = trigger.threshold;
                        thresholdSlider.parentNode.querySelector('.slider-value').textContent = trigger.threshold;
                    }
                } else if (trigger.type === 'memory') {
                    const memorySelect = document.getElementById('memory-target');
                    
                    if (memorySelect && trigger.id) {
                        memorySelect.value = trigger.id;
                    }
                }
            }
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        const app = new App();
    </script>
</body>
</html>
